#!/usr/bin/env bash

# tmux-quit: Kill current session and reattach to previous one
# Usage: tmux-quit

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Icons
ICON_EXIT="üö™"
ICON_SWITCH="üîÑ"
ICON_SESSION="üì∫"

if [ -z "$TMUX" ]; then
    printf "${RED}‚ùå Error: Not inside a tmux session${NC}\n"
    exit 1
fi

# Get current session name
current_session=$(tmux display-message -p '#S')

# Get list of all sessions except current one
other_sessions=$(tmux list-sessions -F '#{session_name}' | grep -v "^${current_session}$")

if [ -z "$other_sessions" ]; then
    printf "${YELLOW}${ICON_EXIT} Last session ${PURPLE}'%s'${NC} ${YELLOW}- exiting tmux${NC}\n" "$current_session"
    tmux kill-server
else
    # Get the most recent session (first in list)
    target_session=$(echo "$other_sessions" | head -n 1)
    
    printf "${CYAN}${ICON_SWITCH} Switching from ${PURPLE}'%s'${NC} ${CYAN}to ${GREEN}'%s'${NC}\n" "$current_session" "$target_session"
    
    # Switch to target session first, then kill current
    tmux switch-client -t "$target_session"
    tmux kill-session -t "$current_session"
fi